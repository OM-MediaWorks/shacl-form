var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{l as root,t as toNumber,m as isObject,f as reactExports,a as sh,c as shFrm,j as jsxRuntimeExports,I as Icon}from"./index-8b62073c.js";import{S as ShaclFormSingleEditorReact}from"./ShaclFormSingleEditorReact-80ad62cb.js";import{f as fetchSparqlEndpoint}from"./index-1203ec0f.js";import"./ShaclFormSingleEditor-f4b70e60.js";import"./___vite-browser-external_commonjs-proxy-164ff0d6.js";var now=__name(function(){return root.Date.now()},"now");const now$1=now;var FUNC_ERROR_TEXT="Expected a function",nativeMax=Math.max,nativeMin=Math.min;function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=!1,maxing=!1,trailing=!0;if(typeof func!="function")throw new TypeError(FUNC_ERROR_TEXT);wait=toNumber(wait)||0,isObject(options)&&(leading=!!options.leading,maxing="maxWait"in options,maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait,trailing="trailing"in options?!!options.trailing:trailing);function invokeFunc(time){var args=lastArgs,thisArg=lastThis;return lastArgs=lastThis=void 0,lastInvokeTime=time,result=func.apply(thisArg,args),result}__name(invokeFunc,"invokeFunc");function leadingEdge(time){return lastInvokeTime=time,timerId=setTimeout(timerExpired,wait),leading?invokeFunc(time):result}__name(leadingEdge,"leadingEdge");function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,timeWaiting=wait-timeSinceLastCall;return maxing?nativeMin(timeWaiting,maxWait-timeSinceLastInvoke):timeWaiting}__name(remainingWait,"remainingWait");function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===void 0||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}__name(shouldInvoke,"shouldInvoke");function timerExpired(){var time=now$1();if(shouldInvoke(time))return trailingEdge(time);timerId=setTimeout(timerExpired,remainingWait(time))}__name(timerExpired,"timerExpired");function trailingEdge(time){return timerId=void 0,trailing&&lastArgs?invokeFunc(time):(lastArgs=lastThis=void 0,result)}__name(trailingEdge,"trailingEdge");function cancel(){timerId!==void 0&&clearTimeout(timerId),lastInvokeTime=0,lastArgs=lastCallTime=lastThis=timerId=void 0}__name(cancel,"cancel");function flush(){return timerId===void 0?result:trailingEdge(now$1())}__name(flush,"flush");function debounced(){var time=now$1(),isInvoking=shouldInvoke(time);if(lastArgs=arguments,lastThis=this,lastCallTime=time,isInvoking){if(timerId===void 0)return leadingEdge(lastCallTime);if(maxing)return clearTimeout(timerId),timerId=setTimeout(timerExpired,wait),invokeFunc(lastCallTime)}return timerId===void 0&&(timerId=setTimeout(timerExpired,wait)),result}return __name(debounced,"debounced"),debounced.cancel=cancel,debounced.flush=flush,debounced}__name(debounce,"debounce");globalThis.process||(globalThis.process={});var _a;(_a=globalThis.process)!=null&&_a.nextTick||(globalThis.process.nextTick=function(callback,...args){globalThis.requestAnimationFrame?globalThis.requestAnimationFrame(()=>callback(...args)):setTimeout(()=>callback(...args))});const fetcher=__name(async(endpoint,sparql,callback)=>{new fetchSparqlEndpoint.SparqlEndpointFetcher().fetchBindings(endpoint,sparql).then(bindingsStream=>bindingsStream.on("data",callback))},"fetcher"),debouncedFetcher=debounce(fetcher,300),_Reference=class _Reference extends ShaclFormSingleEditorReact{template(){const[searchTerm,setSearchTerm]=reactExports.useState(""),[results,setResults]=reactExports.useState([]),[value,setValue]=reactExports.useState(null),sparql=this.shaclPointer.out([sh("select")]).value,endpoint=this.shaclPointer.out([shFrm("source")]).value;reactExports.useEffect(()=>{var _a2;if(!((_a2=this.value)!=null&&_a2.value))return;if(sessionStorage.getItem(this.value.value)){setValue(JSON.parse(sessionStorage.getItem(this.value.value)));return}const tokenizedSparql=sparql.split(`
`).map(line=>line.includes("?searchTerm")?`VALUES ?uri { <${this.value.value}> }`:line).join(`
`);fetcher(endpoint,tokenizedSparql,setValue)},[]),reactExports.useEffect(()=>{if(searchTerm.length<4)return;const tokenizedSparql=sparql.replaceAll("?searchTerm",`"""${searchTerm.split(" ").map(word=>`'${word}'`).join(" AND ")}"""`);setResults([]),debouncedFetcher(endpoint,tokenizedSparql,bindings=>{sessionStorage.setItem(bindings.uri.value,JSON.stringify(bindings)),results.push(bindings),setResults([...results])})},[searchTerm]);const[hasError,setHasError]=reactExports.useState([]);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[value?jsxRuntimeExports.jsxs("div",{className:"p-0 form-control align-items-center d-flex",title:value.uri.value,children:[value.image&&!hasError.includes(value.image.value)?jsxRuntimeExports.jsx("img",{onError:()=>setHasError([...hasError,value.image.value]),className:"image",src:`//wsrv.nl/?url=${value.image.value}&w=35&h=35&fit=cover&a=attention`}):jsxRuntimeExports.jsx("div",{className:"image fallback",style:{aspectRatio:1,background:"#eee"}}),jsxRuntimeExports.jsx("span",{className:"p-1 ps-2",children:value.label.value}),jsxRuntimeExports.jsx("a",{className:"ms-auto me-2",href:value.uri.value,target:"_blank",children:jsxRuntimeExports.jsx(Icon,{icon:"clarity:pop-out-line"})})]}):jsxRuntimeExports.jsx("input",{type:"search",placeholder:"Search",className:"form-control",value:searchTerm,onChange:event=>setSearchTerm(event.target.value)}),results.length?jsxRuntimeExports.jsx("div",{className:"list-group mt-3",children:results.map(result=>jsxRuntimeExports.jsxs("button",{onClick:()=>{this.value=this.df.namedNode(result.uri.value)},className:"p-0 list-group-item list-group-item-action d-flex",children:[result.image&&!hasError.includes(result.image.value)?jsxRuntimeExports.jsx("img",{onError:()=>setHasError([...hasError,result.image.value]),className:"image",src:`//wsrv.nl/?url=${result.image.value}&w=35&h=35&fit=cover&a=attention`}):jsxRuntimeExports.jsx("div",{className:"image fallback",style:{aspectRatio:1,background:"#eee"}}),jsxRuntimeExports.jsx("span",{className:"p-2",children:result.label.value})]},result.uri.value))}):null]})}};__name(_Reference,"Reference");let Reference=_Reference;export{Reference as default};
